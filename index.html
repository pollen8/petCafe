<!DOCTYPE html>
<html>
<head>
  <title>Item Collector Game</title>
  <style>
    body { font-family: Arial; padding: 20px; }
    button { margin: 5px; padding: 10px; }
    #status { margin-top: 20px; }
  </style>
   <style>
    body {
      font-family: sans-serif;
      background: #333;
      color: white;
    }

    #game {
      display: grid;
      grid-template-columns: repeat(20, 32px);
      grid-template-rows: repeat(20, 32px);
      gap: 0;
      margin: 20px auto;
      width: 320px;
      position: relative; /* Ensure the game container is the reference for absolute positioning */
    }

    .tile {
      width: 32px;
      height: 32px;
      image-rendering: pixelated;
    }

    .grass { background: url('grass.png'); }
    .wood { background: url('wood.png'); }
    .stone { background: url('stone.png'); }

    /* Fallback styles if no images yet */
    .tile.grass { background-color: #4caf50; }
    .tile.wood { background-color: #795548; }
    .tile.stone { background-color: #9e9e9e; }

    #character {
      width: 32px;
      height: 32px;
      background-color: rgb(150, 100, 232);
      z-index: 10;
      position: absolute; /* Position the character absolutely */
      top: 0; /* Start at the top */
      left: 0; /* Start at the left */
      transition: top 0.1s, left 0.1s; /* Smooth movement */
    }

    .tile.marketplace {
      background-color: gold;
      border: 2px solid black;
    }

    .tile.house {
      background-color: brown;
      border: 2px solid black;
    }

  </style>
</head>
<body>

  <h1>Item Collector Game</h1>
  <div id="game"></div>

  <div id="status">
    <p><strong>Wood:</strong> <span id="wood-count">0</span></p>
    <p><strong>Money:</strong> $<span id="money">0</span></p>
  </div>

  <div id="shop-modal" style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; color: black; padding: 20px; border: 2px solid black; z-index: 1000;">
    <h2>Shop</h2>
    <p>Choose an option:</p>
    <button id="sell-wood-btn">Sell Wood ($5 per wood)</button>
    <button id="buy-house-btn">Buy House (50 coins)</button>
    <button id="close-shop-btn">Close</button>
  </div>

  <script>
    let wood = 0;
    let money = 0;
    let houseAvailable = false; // Track if a house is available for placement

    function updateDisplay() {
      document.getElementById("wood-count").textContent = wood;
      document.getElementById("money").textContent = money;
    }

    const mapWidth = 20;
    const mapHeight = 20;

    // Simple tile map array using types
    const tileTypes = ['grass', 'wood', 'stone'];
    const mapData = [];

    for (let y = 0; y < mapHeight; y++) {
      for (let x = 0; x < mapWidth; x++) {
        if (y === 0 && x === mapWidth - 1) {
          // Place the marketplace in the top-right corner
          mapData.push('marketplace');
        } else {
          const tileType = tileTypes[Math.floor(Math.random() * tileTypes.length)];
          mapData.push(tileType);
        }
      }
    }

    const gameContainer = document.getElementById("game");

    // Render the tiles
    mapData.forEach((type, index) => {
      const tile = document.createElement("div");
      tile.classList.add("tile", type);
      tile.dataset.index = index; // Store the index of the tile
      gameContainer.appendChild(tile);

      // Add double-click event for placing a house
      tile.addEventListener("dblclick", () => {
        if (houseAvailable) {
          placeHouse(index);
        }
      });
    });

    // Add the character
    const character = document.createElement("div");
    character.id = "character";
    character.style.gridColumnStart = 1;
    character.style.gridRowStart = 1;
    gameContainer.appendChild(character);

    let characterX = 0;
    let characterY = 0;
    const tileSize = 32; // Size of each tile in pixels

    document.addEventListener("keydown", (event) => {
      switch (event.key) {
        case "ArrowUp":
          if (characterY > 0) characterY--;
          break;
        case "ArrowDown":
          if (characterY < mapHeight - 1) characterY++;
          break;
        case "ArrowLeft":
          if (characterX > 0) characterX--;
          break;
        case "ArrowRight":
          if (characterX < mapWidth - 1) characterX++;
          break;
        case "Enter":
          interactWithTile();
          break;
      }
      updateCharacterPosition();
    });

    function updateCharacterPosition() {
      const character = document.getElementById("character");
      character.style.top = `${characterY * tileSize}px`;
      character.style.left = `${characterX * tileSize}px`;
    }

    function interactWithTile() {
      const tileIndex = characterY * mapWidth + characterX;
      const tileType = mapData[tileIndex];

      if (tileType === 'wood') {
        collectWood(tileIndex);
      } else if (tileType === 'marketplace') {
        openShop();
      }
    }

    function collectWood(tileIndex) {
      mapData[tileIndex] = 'grass'; // Change the tile type to grass
      const tile = gameContainer.querySelector(`[data-index="${tileIndex}"]`);
      tile.classList.remove('wood');
      tile.classList.add('grass');
      wood++;
      updateDisplay();

      // Set a timeout to turn the tile back to wood after 30 seconds
      setTimeout(() => {
        mapData[tileIndex] = 'wood'; // Change the tile type back to wood
        tile.classList.remove('grass');
        tile.classList.add('wood');
      }, 30000); // 30 seconds in milliseconds
    }

    function sellWood() {
      if (wood > 0) {
        wood--;
        money += 5;
        updateDisplay();
        alert("You sold 1 wood for $5!");
      } else {
        alert("You have no wood to sell!");
      }
    }

    function openShop() {
      console.log("Opening shop...");
      const shopModal = document.getElementById("shop-modal");
      shopModal.style.display = "block";

      document.getElementById("sell-wood-btn").addEventListener("click", () => {
        sellWood();
        shopModal.style.display = "none";
      });

      document.getElementById("buy-house-btn").addEventListener("click", () => {
        if (money >= 50) {
          const confirmPurchase = confirm("Do you want to buy a house for 50 coins?");
          if (confirmPurchase) {
            money -= 50;
            houseAvailable = true; // Allow house placement
            updateDisplay();
            alert("You bought a house! Double-click on a tile to place it.");
          }
        } else {
          alert("You don't have enough money to buy a house!");
        }
        shopModal.style.display = "none";
      });

      document.getElementById("close-shop-btn").addEventListener("click", () => {
        shopModal.style.display = "none";
      });
    }

    function placeHouse(index) {
      const x = index % mapWidth;
      const y = Math.floor(index / mapWidth);

      // Check if there's enough space for a 2x2 house
      if (
        x < mapWidth - 1 &&
        y < mapHeight - 1 &&
        mapData[index] === 'grass' &&
        mapData[index + 1] === 'grass' &&
        mapData[index + mapWidth] === 'grass' &&
        mapData[index + mapWidth + 1] === 'grass'
      ) {
        // Update the map data
        mapData[index] = 'house';
        mapData[index + 1] = 'house';
        mapData[index + mapWidth] = 'house';
        mapData[index + mapWidth + 1] = 'house';

        // Update the tiles visually
        const tile1 = gameContainer.querySelector(`[data-index="${index}"]`);
        const tile2 = gameContainer.querySelector(`[data-index="${index + 1}"]`);
        const tile3 = gameContainer.querySelector(`[data-index="${index + mapWidth}"]`);
        const tile4 = gameContainer.querySelector(`[data-index="${index + mapWidth + 1}"]`);

        [tile1, tile2, tile3, tile4].forEach((tile) => {
          tile.classList.remove('grass');
          tile.classList.add('house');
        });

        houseAvailable = false; // Reset house availability
        alert("House placed successfully!");
      } else {
        alert("Not enough space to place the house!");
      }
    }
  </script>

</body>
</html>
